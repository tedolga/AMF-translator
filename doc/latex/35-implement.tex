\chapter{Программная реализация модуля}

\section{Выбор технических средств решения задачи}

 Как показали результаты обзора существующих тестовых фреймворков, на данный момент нет решения польностью
 удовлетворяющего поставленным требованиям. Однако многие рассмотренные программные комплексы уже предоставляют часть
 необходимого нам функционала, поэтому для решения поставленной на дипломный
 проект задачи нет необходимсти создавать тестовую утилиту с нуля, разумнее
 будет выбрать одно из существующих решений, и доработать его.
 Чтобы выбрать из предложенного разнообразия подходящий продукт, составим таблицу, где укажем, в какой степени каждый
  тестовый фреймворк удовлетворяет поставленным требованиям.

  ТУТ ТАБЛИЦА

  Анализ показал, что оптимальным выбором, в наибольшей степени удовлетворяющим поставленным требованиям, является
  Apache JMeter. Именно на базе его функционала будет реализовано решение задачи дипломногот проекта.

  Разработка модуля будет осуществляться с использованием языка Java, что обусловлено одним из требований технического
  задания - кросплатформенность приложения. Программы на Java транслируются в байт-код, выполняемый виртуальной машиной
   Java (JVM) — программой, обрабатывающей байтовый код и передающей инструкции оборудованию как интерпретатор, что
   обеспечивает полную независимости байт-кода от операционной системы и оборудования и позволяет выполнять
   Java-приложения на любом устройстве, для которого существует соответствующая виртуальная машина. Также выбранный нами
   тестовый фреймворк Apache JMeter является стопроцентным Java приложением, поэтому для интеграции с ним целесообразно
   использовать именно этот язык.

На текущий момент основным средством обеспечения взаимодействия Flex клиентов с Java приложениями является технология
BlazeDS --- серверная Java-технология для передачи данных, поддерживающая AMF протокол. BlazeDS является бесплатным
приложением с открытым исходным кодом,разработано компанией Adobe. В силу распространённости BlazeDS, одно из основных
функциональных требований к реализации модуля---обработка AMF сообщений--- будет решаться с помощью средств именно
этой техноогии.

В качестве инструмента автоматизации сборки проектов был выбран Apache Maven  фреймворк для автоматизации сборки
проектов, специфицированных на XML-языке POM (Project Object Model).Основныvb преимуществами Maven являются:

\begin{enumerate}
\item Независимость от OS. Сборка проекта происходит в любой операционной системе. Файл проекта один и тот же.
\item Управление зависимостями. Редко какие проекты пишутся без использования сторонних библиотек(зависимостей), которые
 зачастую тоже в свою очередь используют библиотеки разных версий. Мавен позволяет управлять такими сложными
 зависимостями, что позволяет разрешать конфликты версий и в случае необходимости легко переходить на новые версии
 библиотек.
\item Возможна сборка из командной строки. Такое часто необходимо для автоматической сборки проекта на сервере
(Continuous Integration).
\item Хорошая интеграция с средами разработки. Основные среды разработки на java легко открывают проекты которые
собираются c помощью maven. При этом зачастую проект настраивать не нужно - он сразу готов к дальнейшей разработке.
Как следствие - если с проектом работают в разных средах разработки, то maven удобный способ хранения настроек.
Настроечный файл среды разработки и для сборки один и тот же - меньше дублирования данных и соответственно ошибок.
\item Декларативное описание проекта. B файлах проекта pom.xml содержится его декларативное описание, а не отдельные
команды.
\end{enumerate}

Для оптимизации совместной работы над дипломным проектом было принято решение о размещении всех файлов проекта
в репозитории системы контроля версий Git.

В качестве среды разработки бал выбрана IntellijIdea.

\section{Поддержка AMF протокола}

\section{Интеграция с JMeter}

\section{Руководство пользователя}

\subsection{Установка JMeter}

Для начала необходимо скачать с сайта производителя zip архив, содержащий все необходимы для установки файлы,
а затем распаковать его на диске. Место установки JMeter далее будем называть JMETER\_HOME.

\subsection{Установка модуля amf-translator}

Чтобы подключить к JMeter модуль amf-translator, достаточно добавить jar-файл приложения в каталог JMETER\_HOME/lib/ext.

\subsection{Запуск приложения}

Приложение запускается с помощью файла jmeter.bat или ApacheJMeter.jar, находящихся в каталоге JMETER\_HOME/bin.

\subsection{Настройка прокси-сервера}

После запуска в окне приложения с левой стороны нам доступно дерево элементов. Чтобы создать прокси сервер
с поддержкой протокола AMF, необходимо правой кнопкой мыши кликнуть по элементу WorkBench,
а затем добавить элемент AMF Proxy Server (WorkBench > Add > Non-Test Elements > AMF Proxy Server).

\begin{figure}[ht]
\center{\includegraphics[height=120mm, width=160mm]{fig/development/proxySettings.png}}
\caption{Настройка прокси-сервера}
\label{ris:proxySettings.png}
\end{figure}

В поле AmfProxy Port необходимо указать номер порта, который будет слушать наш прокси сервер.
Если указать, например, 9090, то прокси-сервер будет запущен на localhost:9090.
Затем точно такие же настройки прокси-сервера устанавливаются в браузере, с помощью которого будет
производиться тестирование. Также стоит убедиться, что указанный Вами порт уже не занят другим приложением.

\subsection{Запись тестового сценария}

После того, как в AMF Proxy Server установлены все необходимые параметры, нажимается кнопка Start,
запускающая прокси-сервер.

\begin{figure}[h]
\center{\includegraphics[height=120mm, width=160mm]{fig/development/proxyStart.png}}
\caption{Запуск прокси-сервера}
\label{ris:proxyStart.png}
\end{figure}

Затем тестируемое приложение открывается в браузере, для которого также
применены соответсвующие настройки прокси-сервера, и пользователь может выполнять с Flex приложением
необходимые операции, которые будут записываться AMF Proxy Server в виде элементов AMF RPC Sampler и в
дальнейшем могут быть перенесены в тест-план. Чтобы завершить запись тестовых запросов, необходимо
нажать кнопку Stop. После завершения записи тестов, все перехваченные запросы отображаются в дереве
элементов JMeter в качестве дочерних элементов AMF Proxy Server.

\subsection{Создание тест-плана}

Создание тест-плана в JMeter осуществляется следующим образом.
В первую очередь добавляется группа потоков - Thread Group (Test Plan > Threads (Users) > Thread Group).

\begin{figure}[ht]
\center{\includegraphics[height=120mm, width=160mm]{fig/development/testplan.png}}
\caption{Создание тест-плана}
\label{ris:testplan.png}
\end{figure}

Этот элемент является ключевым в тест-плане JMeter, именно его функционал отвечает за реализацию
нагрузочного тестирования --- многопоточного запуска последовательности тестовых шагов.
В данном элементе задается следующее:

\begin{enumerate}
\item Действия, которые будут производиться в случае, если в тест выполняется с ошибкой
(Action to be taken after a Sampler error);
\item Число потоков, в которое будут запускаться шаги тест-плана (Number of Threads);
\item Интервал, в течение которого будет запущено указанное в предыдущем параметре
число потоков (Ramp-Up Period);
\item Число повторений набора тестов (Loop Count);
\item Расписание запуска тестов (Scheduler).
\end{enumerate}

Затем в Thread Group в качестве дочерних элементов добавляются шаги тестов, которые
будут запускаться с указанными характеристиками. В нашем случае мы переносим элементы
AMF RPC Sampler, записанные с помощью прокси.

AMF RPC Sampler представляет собой форму для вызова процедур java-объектов на стороне
сервера. Чтобы вызвать метод удалённого объекта, необходимо заполнить следующие
поля: 

\begin{enumerate}
\item Endpoint Url - URL, по которому отправляется запрос
\item AMF Call - имя удалённого объекта и процедуы, которая должна быть вызвана; 
Например, если мы хоти вызвать у объекта registrationDestionation метод registerUser, 
в этом поле следует написать registrationDestination.registerUser;
\item Request Parameters - параметры метода, вызываемого у объекта (если они 
существуют).
\end{enumerate}

На Рис.~\ref{ris:amfSampler.png} представлен интерфейс AMF RPC Sampler.
\begin{figure}[ht]
\center{\includegraphics[height=120mm, width=160mm]{fig/development/amfSampler.png}}
\caption{Интерфейс элемента AMF RPC Sampler}
\label{ris:amfSampler.png}
\end{figure}
 
Помимо сэмплера в тест-план также следует добавить визуалайзер результатов, чтобы иметь возможность
отслеживать ход тестового сценария (Thread Group > Add > Listener ).
JMeter предлагает большой выбор таких элементов, для примера будем использовать View Results Tree.
После того как план сформирован, он может быть сохранён. (File > Save Test Plan As...)

\subsection{Запуск тестов}

Чтобы запустить содержимое элемента Test Plan, необходимо выбрать в основном меню Run > Start.
После заврешения прогона тестов результаты их выполнения можно наблюдать в View Results Tree.

\begin{figure}[ht]
\center{\includegraphics[height=110mm, width=160mm]{fig/development/testResults.png}}
\caption{Отображение результатов тестов в визуалайзере View Results Tree}
\label{ris:testResults.png}
\end{figure}

В правой части визуалайзера отображается дерево элементов тест плана и статус 
их выполнения - если элемент подсвечен зелёным цветом, то шаг выполнен 
успешно. В случае с AMF RPC Sampler это значит, что соединение с сервером было установлено 
и вызов метода удалённого объекта прошёл без ошибок. Иначе тест не считантся пройденным и 
элемент подсвечивается красным цветом. Также на вкладках слева предоставляется 
возможность просмотра отправленного запроса и полученного от сервера ответа.  

\section{Методика тестирования}